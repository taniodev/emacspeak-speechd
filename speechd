#!/usr/bin/env tclsh

package require Tclx

set servers_dir [file dirname $argv0]
source $servers_dir/tts-lib.tcl
load $servers_dir/linux-speechd/tclspeechd.so
tts_initialize


proc d {} {
    global tts

    loop index 0 [queue_length] {
        set event [queue_remove]
        set type [lindex $event 0]
        set content [lindex $event 1]

        switch $type {
            s {
                say $content
            }
            a {
                exec $tts(play) $content > /dev/null &
            }
        }
    }

    return ""
}


proc l {character} {
    say_character $character
}


proc s {} {
    stop
    queue_clear
}


proc tts_say {text} {
    say $text
}


proc tts_set_speech_rate {rate} {
    set_rate $rate
}


commandloop
